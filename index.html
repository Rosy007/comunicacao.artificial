<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seu EspaÃ§o de Bem-Estar ğŸ’™</title>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#667eea">
  <meta name="description" content="Seu espaÃ§o pessoal para bem-estar emocional e mental">
  <link rel="manifest" href="data:application/manifest+json,%7B%22name%22%3A%22Espa%C3%A7o%20de%20Bem-Estar%22%2C%22short_name%22%3A%22Bem-Estar%22%2C%22description%22%3A%22Seu%20espa%C3%A7o%20pessoal%20para%20bem-estar%20emocional%20e%20mental%22%2C%22start_url%22%3A%22%2F%22%2C%22display%22%3A%22standalone%22%2C%22background_color%22%3A%22%23667eea%22%2C%22theme_color%22%3A%22%23667eea%22%2C%22orientation%22%3A%22portrait%22%2C%22icons%22%3A%5B%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20100%20100'%3E%3Ctext%20y%3D'.9em'%20font-size%3D'90'%3E%F0%9F%92%99%3C%2Ftext%3E%3C%2Fsvg%3E%22%2C%22sizes%22%3A%22192x192%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%2C%7B%22src%22%3A%22data%3Aimage%2Fsvg%2Bxml%2C%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%20100%20100'%3E%3Ctext%20y%3D'.9em'%20font-size%3D'90'%3E%F0%9F%92%99%3C%2Ftext%3E%3C%2Fsvg%3E%22%2C%22sizes%22%3A%22512x512%22%2C%22type%22%3A%22image%2Fsvg%2Bxml%22%7D%5D%7D">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’™</text></svg>">
  <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ’™</text></svg>">
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      padding: 40px;
      border-radius: 30px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    h1 {
      color: #667eea;
      text-align: center;
      margin-bottom: 15px;
      font-size: 2em;
      font-weight: 700;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 0.95em;
    }

    .emoji-header {
      text-align: center;
      font-size: 3em;
      margin-bottom: 20px;
      animation: pulse 2s infinite;
    }

    button {
      width: 100%;
      padding: 18px;
      margin: 12px 0;
      border: none;
      border-radius: 15px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Poppins', sans-serif;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    button:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #f093fb, #f5576c);
      color: white;
      box-shadow: 0 4px 15px rgba(245, 87, 108, 0.4);
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(245, 87, 108, 0.6);
    }

    .btn-success {
      background: linear-gradient(135deg, #4facfe, #00f2fe);
      color: white;
      box-shadow: 0 4px 15px rgba(79, 172, 254, 0.4);
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(79, 172, 254, 0.6);
    }

    .btn-warning {
      background: linear-gradient(135deg, #fa709a, #fee140);
      color: white;
      box-shadow: 0 4px 15px rgba(250, 112, 154, 0.4);
    }

    .btn-back {
      background: #e0e0e0;
      color: #333;
      padding: 12px;
      margin-top: 20px;
    }

    .btn-back:hover {
      background: #d0d0d0;
      transform: translateY(-2px);
    }

    textarea {
      width: 100%;
      padding: 15px;
      border-radius: 15px;
      border: 2px solid #e0e0e0;
      font-size: 15px;
      font-family: 'Poppins', sans-serif;
      margin-bottom: 20px;
      resize: vertical;
      min-height: 120px;
      transition: border 0.3s;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .response-box {
      background: linear-gradient(135deg, #667eea15, #764ba215);
      padding: 25px;
      border-radius: 20px;
      margin: 20px 0;
      border-left: 5px solid #667eea;
      animation: slideIn 0.5s ease-out;
      color: #333;
      line-height: 1.8;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .loading {
      text-align: center;
      color: #667eea;
      font-size: 1.2em;
      padding: 30px;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s infinite;
    }

    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }

    .activity-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .activity-card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      border: 2px solid #e0e0e0;
    }

    .activity-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      border-color: #667eea;
    }

    .activity-icon {
      font-size: 2.5em;
      margin-bottom: 10px;
    }

    .activity-text {
      color: #333;
      font-weight: 600;
      font-size: 0.9em;
    }

    .tip-box {
      background: #fff3cd;
      border-left: 5px solid #ffc107;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
      color: #856404;
    }

    .mood-options {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .mood-btn {
      flex: 1;
      min-width: 150px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 10px;
      margin: 20px 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      animation: progress 2s ease-out forwards;
    }

    @keyframes progress {
      to { width: 100%; }
    }

    .quote-box {
      text-align: center;
      font-style: italic;
      color: #666;
      margin: 20px 0;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 15px;
    }

    /* PWA Install Prompt */
    .install-prompt {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 15px 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      z-index: 1000;
      display: none;
      animation: slideUp 0.5s ease-out;
      max-width: 90%;
      text-align: center;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }

    .install-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      margin: 5px;
      font-family: 'Poppins', sans-serif;
    }

    .install-cancel {
      background: #e0e0e0;
      color: #333;
    }

    /* Offline Indicator */
    .offline-indicator {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #f5576c;
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      font-size: 0.8em;
      display: none;
      z-index: 1000;
    }

    /* PWA Badge */
    .pwa-badge {
      position: fixed;
      top: 10px;
      left: 10px;
      background: #667eea;
      color: white;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.7em;
      z-index: 999;
      display: none;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      z-index: 1001;
      animation: fadeInOut 3s ease-in-out;
      display: none;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
      10%, 90% { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
  </style>
</head>
<body>
  <!-- PWA Elements -->
  <div class="pwa-badge" id="pwaBadge">PWA ğŸ’™</div>
  <div class="offline-indicator" id="offlineIndicator">ğŸ”´ Offline</div>
  <div class="install-prompt" id="installPrompt">
    <p>ğŸ“± Instalar App de Bem-Estar?</p>
    <button class="install-btn" onclick="installApp()">Instalar</button>
    <button class="install-btn install-cancel" onclick="dismissInstall()">Agora nÃ£o</button>
  </div>
  <div class="toast" id="toast"></div>

  <div class="container" id="app">
    <div class="emoji-header">ğŸ’™</div>
    <h1>Seu EspaÃ§o de Bem-Estar</h1>
    <p class="subtitle">Estamos aqui para te ouvir e te ajudar âœ¨</p>
    
    <button class="btn-primary" onclick="iniciarSentimentos()">
      ğŸ˜Š Como estÃ¡ se sentindo hoje?
    </button>
    
    <button class="btn-secondary" onclick="mostrarIdeias()">
      ğŸ’¡ Ideias do que fazer hoje
    </button>

    <div class="quote-box">
      "Cada dia Ã© uma nova oportunidade para ser feliz"
    </div>

    <!-- PWA Status -->
    <div style="text-align: center; margin-top: 20px; font-size: 0.8em; color: #666;">
      <span id="pwaStatus">ğŸ“± App Pronto para Instalar</span>
    </div>
  </div>

  <script>
    // ========== CONFIGURAÃ‡Ã•ES ==========
    const API_KEY = "AIzaSyCSKfiCUgcK8lbNtitro94wfV_OlGbl2Xk";
    let historico = {
      textoUsuario: '',
      emocao: '',
      interacoes: 0
    };

    // ========== PWA FUNCTIONALITY ==========
    let deferredPrompt;

    // Service Worker Registration
    function registerServiceWorker() {
      if ('serviceWorker' in navigator) {
        const swCode = `
          const CACHE_NAME = 'bem-estar-v2';
          const urlsToCache = [
            '/',
            './index.html'
          ];

          self.addEventListener('install', (event) => {
            console.log('Service Worker instalando...');
            event.waitUntil(
              caches.open(CACHE_NAME)
                .then((cache) => {
                  return cache.addAll(urlsToCache);
                })
            );
          });

          self.addEventListener('fetch', (event) => {
            event.respondWith(
              caches.match(event.request)
                .then((response) => {
                  if (response) {
                    return response;
                  }
                  return fetch(event.request);
                })
            );
          });

          self.addEventListener('activate', (event) => {
            event.waitUntil(
              caches.keys().then((cacheNames) => {
                return Promise.all(
                  cacheNames.map((cacheName) => {
                    if (cacheName !== CACHE_NAME) {
                      return caches.delete(cacheName);
                    }
                  })
                );
              })
            );
          });
        `;

        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl)
          .then((registration) => {
            console.log('Service Worker registrado com sucesso:', registration);
          })
          .catch((error) => {
            console.log('Falha no registro do Service Worker:', error);
          });
      }
    }

    // Listen for app installation prompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      showInstallPrompt();
      updatePWAStatus('ğŸ“± App DisponÃ­vel para InstalaÃ§Ã£o');
    });

    // App installed
    window.addEventListener('appinstalled', () => {
      deferredPrompt = null;
      hideInstallPrompt();
      updatePWAStatus('âœ… App Instalado');
      document.getElementById('pwaBadge').style.display = 'block';
      showToast('ğŸ‰ App instalado com sucesso!');
    });

    // Online/Offline detection
    window.addEventListener('online', () => {
      document.getElementById('offlineIndicator').style.display = 'none';
      showToast('âœ… Conectado Ã  internet');
    });

    window.addEventListener('offline', () => {
      document.getElementById('offlineIndicator').style.display = 'block';
      showToast('ğŸ”´ Modo offline ativado');
    });

    // PWA Functions
    function showInstallPrompt() {
      // SÃ³ mostra se o usuÃ¡rio nÃ£o dispensou antes
      if (!localStorage.getItem('installDismissed')) {
        const installPrompt = document.getElementById('installPrompt');
        installPrompt.style.display = 'block';
      }
    }

    function hideInstallPrompt() {
      const installPrompt = document.getElementById('installPrompt');
      installPrompt.style.display = 'none';
    }

    function dismissInstall() {
      hideInstallPrompt();
      localStorage.setItem('installDismissed', 'true');
    }

    async function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          console.log('UsuÃ¡rio aceitou a instalaÃ§Ã£o');
        }
        deferredPrompt = null;
        hideInstallPrompt();
      }
    }

    function updatePWAStatus(message) {
      const statusElement = document.getElementById('pwaStatus');
      if (statusElement) {
        statusElement.textContent = message;
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.display = 'block';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }

    // ========== APP FUNCTIONALITY ==========
    const frases = [
      "Acredite em vocÃª, vocÃª Ã© incrÃ­vel! ğŸŒŸ",
      "Pequenos passos levam a grandes conquistas ğŸš€",
      "VocÃª Ã© mais forte do que imagina ğŸ’ª",
      "Hoje Ã© um Ã³timo dia para ser feliz! â˜€ï¸",
      "Cada respiraÃ§Ã£o Ã© uma nova chance ğŸŒˆ",
      "VocÃª merece toda a felicidade do mundo ğŸ’–"
    ];

    function trocarFrase() {
      const frase = frases[Math.floor(Math.random() * frases.length)];
      const quoteBox = document.querySelector('.quote-box');
      if (quoteBox) {
        quoteBox.style.opacity = '0';
        setTimeout(() => {
          quoteBox.textContent = `"${frase}"`;
          quoteBox.style.opacity = '1';
        }, 300);
      }
    }

    setInterval(trocarFrase, 5000);

    async function perguntarGemini(pergunta) {
      // Verificar se estÃ¡ offline
      if (!navigator.onLine) {
        return "ğŸ“¶ VocÃª estÃ¡ offline no momento. Aqui estÃ¡ uma mensagem especial para vocÃª: " + gerarRespostaLocal(pergunta);
      }

      try {
        console.log('Enviando requisiÃ§Ã£o para Gemini...');
        
        const resposta = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: pergunta }] }]
            })
          }
        );

        console.log('Status da resposta:', resposta.status);
        
        if (!resposta.ok) {
          const errorData = await resposta.json();
          console.error('Erro da API:', errorData);
          
          if (resposta.status === 400) {
            return "âš ï¸ Problema de configuraÃ§Ã£o. Usando modo offline... " + gerarRespostaLocal(pergunta);
          } else if (resposta.status === 403) {
            return "ğŸ”’ Acesso negado. Usando modo offline... " + gerarRespostaLocal(pergunta);
          } else if (resposta.status === 429) {
            return "â° Muitas requisiÃ§Ãµes. Usando modo offline... " + gerarRespostaLocal(pergunta);
          } else if (resposta.status === 404) {
            return "ğŸ” Modelo nÃ£o encontrado. Tentando alternativa...";
          }
          
          return "âŒ Erro na API. " + gerarRespostaLocal(pergunta);
        }
        
        const data = await resposta.json();
        console.log('Resposta recebida com sucesso!');
        
        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
          return data.candidates[0].content.parts[0].text;
        } else {
          console.error('Estrutura de resposta inesperada:', data);
          return "âš ï¸ Recebi uma resposta invÃ¡lida. " + gerarRespostaLocal(pergunta);
        }
        
      } catch (error) {
        console.error('Erro ao chamar Gemini:', error);
        return "ğŸŒ Erro de conexÃ£o. " + gerarRespostaLocal(pergunta);
      }
    }

    // FunÃ§Ã£o alternativa caso o modelo principal nÃ£o funcione
    async function perguntarGeminiAlternativo(pergunta) {
      try {
        console.log('Tentando modelo alternativo...');
        
        const resposta = await fetch(
          `https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${API_KEY}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: pergunta }] }]
            })
          }
        );

        if (!resposta.ok) {
          throw new Error(`Erro ${resposta.status}`);
        }
        
        const data = await resposta.json();
        
        if (data.candidates && data.candidates[0] && data.candidates[0].content) {
          return data.candidates[0].content.parts[0].text;
        } else {
          return gerarRespostaLocal(pergunta);
        }
        
      } catch (error) {
        console.error('Erro no modelo alternativo:', error);
        return gerarRespostaLocal(pergunta);
      }
    }

    // Fallback local caso a API nÃ£o funcione
    function gerarRespostaLocal(pergunta) {
      const respostasLocais = [
        "Entendo como vocÃª se sente. Lembre-se que cada dia Ã© uma nova oportunidade para recomeÃ§ar! ğŸ’™",
        "VocÃª Ã© mais forte do que imagina. Continue seguindo em frente, um passo de cada vez! âœ¨",
        "Os momentos difÃ­ceis nÃ£o duram para sempre. VocÃª tem a forÃ§a necessÃ¡ria para superar isso! ğŸŒŸ",
        "Respire fundo e lembre-se: vocÃª jÃ¡ superou tantos desafios antes, e vai superar este tambÃ©m! ğŸ’ª",
        "A vida Ã© como as estaÃ§Ãµes - depois do inverno, sempre vem a primavera. Melhores dias virÃ£o! ğŸŒ¸",
        "VocÃª Ã© capaz de coisas incrÃ­veis! Acredite no seu potencial e continue seguindo seus sonhos! ğŸš€",
        "Ã€s vezes, tudo o que precisamos Ã© de um momento para respirar e recarregar as energias. VocÃª consegue! ğŸŒˆ",
        "Seu bem-estar Ã© importante. Cuide de vocÃª com carinho e paciÃªncia hoje! ğŸ’–",
        "As nuvens mais escuras sempre passam. O sol vai brilhar para vocÃª novamente! â˜€ï¸",
        "VocÃª nÃ£o estÃ¡ sozinho(a). Muitas pessoas se importam com vocÃª e torcem pela sua felicidade! ğŸ¤—"
      ];
      
      return respostasLocais[Math.floor(Math.random() * respostasLocais.length)];
    }

    function iniciarSentimentos() {
      historico.interacoes++;
      document.getElementById('app').innerHTML = `
        <div class="emoji-header">ğŸ’­</div>
        <h1>Conte-nos sobre o seu dia</h1>
        <p class="subtitle">Escreva livremente, estamos aqui para te ouvir</p>
        
        <div class="tip-box">
          ğŸ’¡ <strong>Dica:</strong> NÃ£o tenha medo de se expressar. Quanto mais vocÃª compartilhar, melhor poderemos te ajudar!
        </div>

        <textarea id='texto' placeholder='O que aconteceu hoje? Como vocÃª se sente? Conte-nos...'></textarea>
        
        <button class="btn-success" onclick="validarTexto()">
          âœ¨ Continuar
        </button>
        
        <button class="btn-back" onclick="voltarInicio()">
          â† Voltar
        </button>
      `;
    }

    function validarTexto() {
      const texto = document.getElementById('texto').value.trim();
      
      if (texto.length < 10) {
        alert('Por favor, escreva um pouco mais para que possamos te ajudar melhor! ğŸ˜Š');
        return;
      }

      historico.textoUsuario = texto;
      mostrarOpcoesSentimento();
    }

    function mostrarOpcoesSentimento() {
      document.getElementById('app').innerHTML = `
        <div class="emoji-header">ğŸ¯</div>
        <h1>Como podemos te ajudar?</h1>
        <p class="subtitle">Escolha a opÃ§Ã£o que mais combina com vocÃª agora</p>

        <div class="progress-bar">
          <div class="progress-fill"></div>
        </div>
        
        <button class="btn-primary mood-btn" onclick="processarEmocao('feliz')">
          ğŸ˜Š Quero me sentir mais feliz
        </button>
        
        <button class="btn-secondary mood-btn" onclick="processarEmocao('triste')">
          ğŸ˜¢ Preciso desabafar
        </button>
        
        <button class="btn-warning mood-btn" onclick="processarEmocao('conselho')">
          ğŸ’¡ Preciso de um conselho
        </button>

        <button class="btn-success mood-btn" onclick="processarEmocao('motivacao')">
          ğŸš€ Quero motivaÃ§Ã£o
        </button>
        
        <button class="btn-back" onclick="iniciarSentimentos()">
          â† Voltar
        </button>
      `;
    }

    async function processarEmocao(tipo) {
      historico.emocao = tipo;
      
      document.getElementById('app').innerHTML = `
        <div class="loading">
          <div class="emoji-header">ğŸ¤”</div>
          <h2>Preparando algo especial para vocÃª</h2>
        </div>
      `;

      let prompt = '';
      
      if (tipo === 'feliz') {
        prompt = `A pessoa disse: "${historico.textoUsuario}". 
        Responda de forma calorosa e motivacional, contando uma histÃ³ria inspiradora curta, 
        uma piada leve ou uma mensagem positiva que possa alegrar o dia dela. 
        Mantenha o tom amigÃ¡vel e use emojis. MÃ¡ximo 150 palavras.`;
      } else if (tipo === 'triste') {
        prompt = `A pessoa estÃ¡ passando por isso: "${historico.textoUsuario}". 
        Responda com empatia profunda, validando os sentimentos dela. 
        Seja um ouvinte compreensivo e ofereÃ§a conforto genuÃ­no. 
        Use um tom acolhedor e empÃ¡tico. MÃ¡ximo 150 palavras.`;
      } else if (tipo === 'conselho') {
        prompt = `A pessoa compartilhou: "${historico.textoUsuario}". 
        DÃª um conselho prÃ¡tico, sÃ¡bio e encorajador baseado na situaÃ§Ã£o. 
        Seja especÃ­fico e ofereÃ§a passos prÃ¡ticos que ela possa seguir. 
        Mantenha o tom amigÃ¡vel e motivador. MÃ¡ximo 150 palavras.`;
      } else if (tipo === 'motivacao') {
        prompt = `A pessoa disse: "${historico.textoUsuario}". 
        Crie uma mensagem super motivacional e energizante! 
        FaÃ§a ela sentir que pode conquistar qualquer coisa. 
        Use exemplos de superaÃ§Ã£o e seja muito positivo. MÃ¡ximo 150 palavras.`;
      }

      let resposta = await perguntarGemini(prompt);
      
      if (resposta.includes("Erro") || resposta.includes("nÃ£o encontrado") || resposta.includes("âš ï¸")) {
        resposta = await perguntarGeminiAlternativo(prompt);
      }
      
      mostrarResposta(resposta, tipo);
    }

    function mostrarResposta(resposta, tipo) {
      let emoji = tipo === 'feliz' ? 'ğŸ˜Š' : tipo === 'triste' ? 'ğŸ’™' : tipo === 'motivacao' ? 'ğŸš€' : 'ğŸ’¡';
      
      document.getElementById('app').innerHTML = `
        <div class="emoji-header">${emoji}</div>
        <h1>Mensagem para vocÃª</h1>
        
        <div class="response-box">
          ${resposta}
        </div>

        <div class="tip-box">
          ğŸ’™ Lembre-se: VocÃª nÃ£o estÃ¡ sozinho(a). Sempre hÃ¡ alguÃ©m disposto a te ouvir e te ajudar!
        </div>
        
        <button class="btn-success" onclick="compartilharFeedback()">
          â­ Isso me ajudou!
        </button>

        <button class="btn-primary" onclick="mostrarOpcoesSentimento()">
          ğŸ”„ Tentar outra opÃ§Ã£o
        </button>
        
        <button class="btn-back" onclick="voltarInicio()">
          â† Voltar ao inÃ­cio
        </button>
      `;
    }

    function compartilharFeedback() {
      document.getElementById('app').innerHTML = `
        <div class="emoji-header">ğŸ‰</div>
        <h1>Que Ã³timo saber disso!</h1>
        
        <div class="response-box">
          Ficamos muito felizes em ter ajudado! VocÃª Ã© incrÃ­vel e merece toda a felicidade do mundo. 
          Continue sempre acreditando em vocÃª! ğŸ’™âœ¨
        </div>

        <div class="quote-box">
          "A felicidade estÃ¡ nas pequenas coisas, e vocÃª acabou de criar um momento feliz!" ğŸŒŸ
        </div>
        
        <button class="btn-primary" onclick="voltarInicio()">
          ğŸ  Voltar ao inÃ­cio
        </button>
      `;
    }

    function mostrarIdeias() {
      historico.interacoes++;
      document.getElementById('app').innerHTML = `
        <div class="emoji-header">ğŸ¨</div>
        <h1>O que vocÃª gostaria de fazer?</h1>
        <p class="subtitle">Escolha uma atividade para o seu bem-estar</p>

        <div class="activity-grid">
          <div class="activity-card" onclick="sugerirAtividade('relaxar')">
            <div class="activity-icon">ğŸ§˜</div>
            <div class="activity-text">Relaxar</div>
          </div>

          <div class="activity-card" onclick="sugerirAtividade('divertir')">
            <div class="activity-icon">ğŸ®</div>
            <div class="activity-text">Me divertir</div>
          </div>

          <div class="activity-card" onclick="sugerirAtividade('aprender')">
            <div class="activity-icon">ğŸ“š</div>
            <div class="activity-text">Aprender algo</div>
          </div>

          <div class="activity-card" onclick="sugerirAtividade('social')">
            <div class="activity-icon">ğŸ’¬</div>
            <div class="activity-text">Socializar</div>
          </div>

          <div class="activity-card" onclick="sugerirAtividade('exercicio')">
            <div class="activity-icon">ğŸƒ</div>
            <div class="activity-text">Me exercitar</div>
          </div>

          <div class="activity-card" onclick="sugerirAtividade('criativo')">
            <div class="activity-icon">ğŸ¨</div>
            <div class="activity-text">Ser criativo</div>
          </div>
        </div>
        
        <button class="btn-back" onclick="voltarInicio()">
          â† Voltar
        </button>
      `;
    }

    async function sugerirAtividade(tipo) {
      document.getElementById('app').innerHTML = `
        <div class="loading">
          <div class="emoji-header">âœ¨</div>
          <h2>Criando sugestÃµes personalizadas para vocÃª</h2>
        </div>
      `;

      let prompt = '';
      
      if (tipo === 'relaxar') {
        prompt = `Sugira 5 atividades relaxantes e detalhadas que uma pessoa pode fazer hoje. 
        Inclua opÃ§Ãµes como meditaÃ§Ã£o, leitura, mÃºsica, etc. 
        Seja especÃ­fico e criativo. Use emojis e formataÃ§Ã£o clara.`;
      } else if (tipo === 'divertir') {
        prompt = `Sugira 5 atividades divertidas e envolventes para fazer hoje. 
        Pode incluir jogos, filmes, hobbies, etc. 
        Seja entusiasmado e criativo. Use emojis.`;
      } else if (tipo === 'aprender') {
        prompt = `Sugira 5 formas interessantes de aprender algo novo hoje. 
        Pode incluir cursos online, documentÃ¡rios, livros, podcasts, etc. 
        Seja inspirador. Use emojis.`;
      } else if (tipo === 'social') {
        prompt = `Sugira 5 formas de socializar e conectar com outras pessoas hoje. 
        Pode incluir atividades presenciais e online. 
        Seja acolhedor e inclusivo. Use emojis.`;
      } else if (tipo === 'exercicio') {
        prompt = `Sugira 5 atividades fÃ­sicas que alguÃ©m pode fazer hoje. 
        Inclua opÃ§Ãµes para diferentes nÃ­veis de energia. 
        Seja motivador e prÃ¡tico. Use emojis.`;
      } else if (tipo === 'criativo') {
        prompt = `Sugira 5 atividades criativas que alguÃ©m pode fazer hoje. 
        Pode incluir arte, escrita, mÃºsica, culinÃ¡ria, etc. 
        Seja inspirador e imaginativo. Use emojis.`;
      }

      let resposta = await perguntarGemini(prompt);
      
      if (resposta.includes("Erro") || resposta.includes("nÃ£o encontrado") || resposta.includes("âš ï¸")) {
        resposta = await perguntarGeminiAlternativo(prompt);
      }
      
      document.getElementById('app').innerHTML = `
        <div class="emoji-header">ğŸ¯</div>
        <h1>SugestÃµes para vocÃª</h1>
        
        <div class="response-box">
          ${resposta}
        </div>

        <div class="tip-box">
          ğŸ’¡ <strong>Dica:</strong> NÃ£o precisa fazer tudo de uma vez! Escolha o que mais te atrai agora e divirta-se! ğŸ˜Š
        </div>
        
        <button class="btn-primary" onclick="mostrarIdeias()">
          ğŸ”„ Ver outras categorias
        </button>
        
        <button class="btn-back" onclick="voltarInicio()">
          â† Voltar ao inÃ­cio
        </button>
      `;
    }

    function voltarInicio() {
      document.getElementById('app').innerHTML = `
        <div class="emoji-header">ğŸ’™</div>
        <h1>Seu EspaÃ§o de Bem-Estar</h1>
        <p class="subtitle">Estamos aqui para te ouvir e te ajudar âœ¨</p>
        
        <button class="btn-primary" onclick="iniciarSentimentos()">
          ğŸ˜Š Como estÃ¡ se sentindo hoje?
        </button>
        
        <button class="btn-secondary" onclick="mostrarIdeias()">
          ğŸ’¡ Ideias do que fazer hoje
        </button>

        <div class="quote-box">
          "Cada dia Ã© uma nova oportunidade para ser feliz"
        </div>

        <div style="text-align: center; margin-top: 20px; font-size: 0.8em; color: #666;">
          <span id="pwaStatus">ğŸ“± App Pronto para Instalar</span>
        </div>
      `;
    }

    // ========== INICIALIZAÃ‡ÃƒO ==========
    window.addEventListener('load', () => {
      // Registrar Service Worker
      registerServiceWorker();
      
      // Verificar se o app jÃ¡ estÃ¡ instalado
      if (window.matchMedia('(display-mode: standalone)').matches) {
        updatePWAStatus('âœ… App Instalado');
        document.getElementById('pwaBadge').style.display = 'block';
      }

      // Verificar estado da conexÃ£o
      if (!navigator.onLine) {
        document.getElementById('offlineIndicator').style.display = 'block';
      }

      // Iniciar troca de frases
      trocarFrase();
    });
  </script>
</body>
</html>
